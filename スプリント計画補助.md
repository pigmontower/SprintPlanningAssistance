---
開始日: 2025-08-04
---
# 使い方
1. プロパティの「開始日」にスプリント開始日を入れる
2. 「タスク名 {n}h 日付:: {YYYY-MM-DD}」を任意の場所に入力する
3. 文書内の何もないところをクリックしてフォーカスを外す
4. 該当スプリント内のタスクがカレンダー上に表示される

```dataviewjs
/***** 設定（最小） **************************************************/
// プロパティ「開始日」を読む（なければ既定日）
const START_DATE = dv.current()?.["開始日"] ?? "2025-08-04";
const WEEKS      = 2;             // 2週間分
/*********************************************************************/

const LABELS = ["月","火","水","木","金","土","日"];
const toArr = v => v?.array ? v.array() : Array.from(v ?? []);

// 週初日の計算（Dataview 日付型のみ）
function startOfWeek(d){
  const want = 1;                                   // 1=月曜日
  const delta = (d.weekday - want + 7) % 7;         // weekday:1..7
  return d.minus({ days: delta });
}
const BASE = startOfWeek(dv.date(START_DATE));

// すべてのチェックボックスタスク（完了済みも含む）
const ALL = toArr(dv.pages()).flatMap(p => toArr(p.file.tasks));

// タスク行の text から「日付:: YYYY-MM-DD」を拾う（同一行に書くこと）
function getDateStr(t){
  const m = (t.text || "").match(/日付::\s*(\d{4}-\d{2}-\d{2})/);
  return m ? m[1] : null;
}

// 工数の合計（"工数:: 2h30m" / "2h" / "90m" などを足す）
function sumMinutes(items){
  let total = 0;
  for (const t of items){
    const s = (t.text || "");
    let m;
    if ((m = s.match(/工数::\s*(\d+)\s*h\s*(\d+)\s*m/i)))      total += (+m[1])*60 + (+m[2]);
    else if ((m = s.match(/工数::\s*(\d+)\s*h/i)))             total += (+m[1])*60;
    else if ((m = s.match(/工数::\s*(\d+)\s*m/i)))             total += (+m[1]);
    else if ((m = s.match(/(\d+)\s*h\s*(\d+)\s*m/i)))          total += (+m[1])*60 + (+m[2]);
    else if ((m = s.match(/(\d+)\s*h/i)))                      total += (+m[1])*60;
    else if ((m = s.match(/(\d+)\s*m/i)))                      total += (+m[1]);
  }
  return total;
}

// 表示用にタスク本文を整形（「日付::」「工数::」は隠す）
function pretty(t){
  return (t.text || "")
    .replace(/日付::\s*\d{4}-\d{2}-\d{2}/g, "")
    .replace(/工数::\s*[\dhm\s]+/gi, "")
    .trim();
}

// 指定日のセルHTML
function cellFor(day){
  const iso = day.toISODate();
  const items = ALL.filter(t => getDateStr(t) === iso);
  if (!items.length) return "";

  const lines = items.map(t => pretty(t));
  const mins  = sumMinutes(items);
  const total = mins > 0 ? `<br><b>合計: ${Math.floor(mins/60)}h${mins%60? (mins%60+"m"):""}</b>` : "";
  return lines.join("<br>") + total;
}

// 1週分を自前HTMLテーブルで描画
function renderWeek(weekStart){
  const days = Array.from({length:7}, (_,i)=> weekStart.plus({days:i}));
  let html = `<table class="dv-simple-week"><thead><tr>`;
  for (let i=0;i<7;i++){
    html += `<th>${days[i].toFormat("d")}(${LABELS[i]})</th>`;
  }
  html += `</tr></thead><tbody><tr>`;
  for (const d of days){
    html += `<td>${cellFor(d) || ""}</td>`;
  }
  html += `</tr></tbody></table>`;
  dv.el("div", html);
}

// スタイル
dv.el("style", `
.dv-simple-week{border-collapse:collapse;width:100%;margin:8px 0}
.dv-simple-week th,.dv-simple-week td{border:1px solid var(--table-border-color, #ccc);vertical-align:top;padding:.4rem}
.dv-simple-week th{text-align:center;font-weight:700}
`);

// 2週間ぶん描画
for (let w=0; w<WEEKS; w++){
  const ws = BASE.plus({ weeks: w });
  dv.header(3, `${ws.toFormat("yyyy-MM-dd")} 週`);
  renderWeek(ws);
}
```

- [ ] 会議 2h 日付::  2025-08-04
- [ ] 製造 3h 日付::2025-08-04
- [ ] テスト仕様書作成 2h 日付::2025-08-04
- [ ] テスト仕様書作成 7h 日付::2025-08-05
- [ ] レビュー 2h 日付::2025-08-06
- [ ] テスト修正 7h 日付::2025-08-07
- [ ] ドキュメント修正 3h 日付::2025-08-11
- [ ] 実装作業 2h 日付::2025-08-12
- [ ] テスト実行 1h 日付::2025-08-13
- [ ] テスト実行 工数:: 6h  日付:: 2025-08-15
